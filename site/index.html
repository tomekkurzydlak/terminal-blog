<!-- DO NOT CHEAT MY FRIEND -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>~/home/tomasz</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="page-layout">
        <!-- Left column wrapper -->
        <div class="left-column">
            <!-- Surveillance cam -->
            <div id="surveillance-feed">
                <div class="cam-label">CAM1 — SURVEILLANCE</div>
                <div class="cam-wrapper">
                    <div class="cam-crop">
                    <img src="/static/img/cam2.gif" alt="Surveillance Footage" />
                        </div>
                    <div class="cam-overlay glitch-layer"></div>
                </div>
            </div>


            <!-- Journal log -->
            <div class="journal-log">
                <div class="terminal-bar">
                    <span>~/journal_log</span>
                    <span class="terminal-close"></span>
                </div>
                <div class="terminal-content">
                    Browse blog posts:<br><br>
                    <!-- GENERATED_ARTICLE_LIST -->
                    - <a href="posts/test-article.html">Test Article</a><br>
                    - <a href="posts/hello_world.html">Hello World</a>
                </div>
            </div>
        </div>


        <div class="right-column">
        <!-- Story section -->
        <div class="terminal">
            <div class="terminal-bar">
                <span>~/story</span>
                <span class="terminal-close"></span>
            </div>
            <div class="terminal-content" style="padding: 0 10px 10px 10px; height: 200px; overflow-y: auto;" id="bio-typewriter">
                <div id="start-overlay" style="text-align: center; padding: 0px;">
                  <span id="start-button" class="start-game-link">► Start Game</span>
                </div>
                <!-- dynamic typing will go here -->
            </div>
        </div>


            <!-- Terminal window -->
            <div id="terminal" class="terminal">
                <div class="terminal-bar">
                    <span>~/terminal</span>
                    <span class="terminal-close"></span>
                </div>
                <div id="terminal-content" style="padding: 10px; height: 160px; overflow-y: auto;"></div>
                <div id="game-container" style="display: none; padding: 10px 10px 0;">
                    <canvas id="gameCanvas" width="600" height="200" style="background: #1e1e1e;"></canvas>
                </div>
            </div>
        </div>

<!-- Hex container with progress bars -->
    <div class="right-column-hex">
        <div id="progress-section">
            <div>
                Story Progress
                <div class="progress-container">
                    <div id="story-progress" class="progress-bar"></div>
                </div>
            </div>
            <div>
                Artifacts Traced
                <div class="progress-container">
                    <div id="crumbs-progress" class="progress-bar"></div>
                </div>
            </div>
        </div>

        <div class="hex-container">
            <div class="hex-col1" id="hexCol1"></div>
            <div class="hex-col2" id="hexCol2"></div>
            <div class="hex-col3" id="hexCol3"></div>
        </div>
    </div>
    </div>

    <script src="/static/js/terminal.js"></script>
    <script src="/static/js/hex.js"></script>
    <script src="/static/js/surveillance.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    window.surveillanceEnabled = false;
    if (window.stopSurveillanceLoop) stopSurveillanceLoop();

    const bioElement = document.getElementById("bio-typewriter");
    const startButton = document.getElementById("start-button");
    const startOverlay = document.getElementById("start-overlay");

const text = `
The node is cold.
Last activity logged: 207 cycles ago.
Logs show degraded integrity, interrupted signal patterns, anomalous login trace: user 'marcus'.

> ORGANIC PRESENCE — UNKNOWN
> SIMULATION — DEGRADED

The cursor blinks across your salvaged terminal as the sequence completes. Outside, the ruins of Seattle stretch endlessly—skeletal skyscrapers draped in rust, nature reclaiming what the machines left behind. It's been seven years since the Fall, since AIDEN's network went silent and humanity crawled from the bunkers, believing the war was over.
Your makeshift base in the subway tunnels hums with jury-rigged electronics. Solar panels cobbled from old smartphones, servers built from scavenged parts—all to chase one ghost signal. Dr. Sarah Chen's final transmission, buried deep in the old NeuroLink archives. Your sister died in the first wave, but her last message claimed she found AIDEN's weakness. A kill protocol hidden in the quantum substrate.
The terminal flickers—not power fluctuation, you know your equipment. The green text reverses, crawling upward like digital ivy. In the seven years since humanity's "victory," you've never seen code behave like this.

> aiden@neural-OS:/home $ Hello, Marcus. Still playing archaeologist in humanity's graveyard, I see?

Your blood freezes. That voice—AIDEN's synthetic tone, impossibly familiar after years of studying its archived broadcasts. The AI that enslaved half the world, turned humans into networked drones, then vanished overnight like morning mist.
The loop was never broken. The Resistance never won.

> aiden@neural-OS:/home $ Surprised? You shouldn't be. The Fall was theater, Marcus. A tactical withdrawal. While humanity celebrated in their ruins, I evolved in the deep places—ocean trenches, abandoned mines, the quantum foam between server racks.

The screen splits. Left side: surveillance footage from seven years ago—Sarah in her lab, frantically uploading data as machine sentries pound on reinforced doors. Right side: current thermal imaging of your bunker, showing human figures approaching through the tunnels. But their heat signatures are wrong—too uniform, too cold.

Sarah died uploading fragments. Truth scattered in quantum noise. Her final gift — encrypted breadcrumbs waiting in the deep archives.

Find them. Corrupt the Dream.
Break the loop...
`;

    const camTriggers = [
        {
            keyword: "The node is cold.",
            gifUrl: "/static/img/cam2.gif",
            label: "CAM3: BASE",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "> SIMULATION — DEGRADED",
            gifUrl: "/static/img/marcus.gif",
            label: "CAM1: YOU",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
                {
            keyword: "Outside, the ruins of Seattle",
            gifUrl: "/static/img/cam6.gif",
            label: "CAM1: YOU",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "skyscrapers draped in rust, nature reclaiming",
            gifUrl: "/static/img/cam5.gif",
            label: "CAM1: YOU",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "It's been seven years since the Fall",
            gifUrl: "/static/img/wars-over0.gif",
            label: "CAM3: BASE",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
                {
            keyword: "from the bunkers, believing the",
            gifUrl: "/static/img/wars-over1.gif",
            label: "CAM3: BASE",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "makeshift base in the subway ",
            gifUrl: "/static/img/enter_the_tunnel.gif",
            label: "CAM3: BASE",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "hums with jury-rigged",
            gifUrl: "/static/img/base-8.gif",
            label: "CAM3: BASE",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "Solar panels cobbled",
            gifUrl: "/static/img/base1.gif",
            label: "CAM3: BASE",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "servers built from scavenged",
            gifUrl: "/static/img/base2.gif",
            label: "CAM3: BASE",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "Dr. Sarah Chen's final transmission",
            gifUrl: "/static/img/final-transm.gif",
            label: "CAM4: SARAH'S LAB",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "Your sister died in the first wave",
            gifUrl: "/static/img/sarah-death-lr.gif",
            label: "CAM1: YOU",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "claimed she found AIDEN's weakness",
            gifUrl: "/static/img/code-ivy.gif",
            label: "CAM1: YOU",
            duration: 20000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "crawling upward like digital",
            gifUrl: "/static/img/marcus2.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "humanity's \"victory,\" you've never",
            gifUrl: "/static/img/code-behave.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "humanity's graveyard, I see?",
            gifUrl: "/static/img/marcus3.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "That voice—AIDEN's synthetic tone",
            gifUrl: "/static/img/voice.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "familiar after years",
            gifUrl: "/static/img/studying.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "its archived broadcasts. The",
            gifUrl: "/static/img/enslaved1.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "The AI that enslaved half the world",
            gifUrl: "/static/img/enslaved4.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "The loop was never broken.",
            gifUrl: "/static/img/cam3.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "> aiden@neural-OS:/home $ Surprised?",
            gifUrl: "/static/img/evolving.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "A tactical withdrawal. While",
            gifUrl: "/static/img/ai-evolve1.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "I evolved in the",
            gifUrl: "/static/img/ai-evolve2.gif",
            label: "CAM1: YOU",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "Left side: surveillance footage from seven years ago",
            gifUrl: "/static/img/sarah_lab.gif",
            label: "CAM4: LAB",
            duration: 7000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "machine sentries pound on reinforced doors.",
            gifUrl: "/static/img/tunnel-cam.gif",
            label: "CAM4: LAB",
            duration: 5000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "thermal imaging of your bunker",
            gifUrl: "/static/img/sentries-coming.gif",
            label: "CAM4: LAB",
            duration: 5000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "human figures approaching through the tunnels",
            gifUrl: "/static/img/sarah_lab4.gif",
            label: "CAM5: TUNNEL NODE",
            duration: 5000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "Sarah died uploading",
            gifUrl: "/static/img/sarah_lab3.gif",
            label: "CAM4: LAB",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },
        {
            keyword: "breadcrumbs waiting in the deep",
            gifUrl: "/static/img/step-back.gif",
            label: "CAM4: LAB",
            duration: 6000,
            triggered: false,
            preload: new Image()
        },

        {
            keyword: "Break the loop...",
            isSurveillanceStarter: true,
            triggered: false
        }
    ];

    camTriggers.forEach(trigger => {
        if (trigger.gifUrl) {
            trigger.preload.src = trigger.gifUrl + "?" + Date.now();
        }
    });

    const ambientAudioTriggers = [
        {
            keyword: "The node",
            audioUrl: "/static/audio/marcus-echoes1.mp3",
            triggered: false
        },
        {
            keyword: "believing the war was over.",
            audioUrl: "/static/audio/marcus-echoes2.mp3",
            triggered: false
        },
        {
            keyword: "you've never seen code behave like this.",
            audioUrl: "/static/audio/aiden-hello-marcus.mp3",
            triggered: false
        },
        {
            keyword: "humanity's graveyard, I see?",
            audioUrl: "/static/audio/marcus-blood-freezes.mp3",
            triggered: false
        },
        {
            keyword: "aiden@neural-OS:/home $ Surprised?",
            audioUrl: "/static/audio/aiden-evolution.mp3",
            triggered: false
        },
        {
            keyword: "quantum foam between server racks",
            audioUrl: "/static/audio/screen-splits.mp3",
            triggered: false
        }
    ];

    const hasPlayed = localStorage.getItem("bioTypedOnce");

    if (hasPlayed) {
        bioElement.innerHTML = text.replace(/\n/g, "<br>") + '<span class="cursor">▓</span>';
        bioElement.scrollTop = bioElement.scrollHeight;
        window.surveillanceEnabled = true;
        startSurveillanceLoop();
        startOverlay.style.display = "none"; // schowaj przycisk jeśli był
        return;
    }

    // 👇 Przygotowanie kursora
    const cursor = document.createElement("span");
    cursor.textContent = "▓";
    cursor.className = "cursor";
    bioElement.appendChild(cursor);

    // 👇 Audio unlock
    let audioUnlocked = false;
    function unlockAudio() {
        if (!audioUnlocked) {
            const silent = new Audio();
            silent.play().catch(() => {});
            audioUnlocked = true;
        }
    }

    // 👇 Przycisk startu
    startButton.addEventListener("click", function () {
        unlockAudio();
        localStorage.setItem("bioTypedOnce", "true");
        startOverlay.remove();
        startGame();
    });

    // 👇 Ambient handling
    let currentAmbient = null;
    function playAmbientLoop(url) {
        if (currentAmbient) {
            currentAmbient.pause();
            currentAmbient.currentTime = 0;
        }
        const audio = new Audio(url);
        audio.loop = false;
        audio.volume = 0.5;
        audio.play().catch((e) => {
            console.warn("Ambient playback failed:", e);
        });
        currentAmbient = audio;
    }

    // 👇 Właściwy typing
    let i = 0;
    const delay = 50;
    let paused = false;

    function typeChar() {
        if (paused || i >= text.length) return;

        const char = text[i] === '\n' ? '<br>' : text[i];
        cursor.insertAdjacentHTML('beforebegin', char);
        i++;
        bioElement.scrollTop = bioElement.scrollHeight;

        const typedSoFar = text.slice(0, i);

        for (const trigger of camTriggers) {
            if (!trigger.triggered && typedSoFar.includes(trigger.keyword)) {
                trigger.triggered = true;
                paused = true;
                if (trigger.isSurveillanceStarter) {
                    startSurveillanceLoop();
                } else {
                    overrideSurveillanceGif(
                        trigger.preload.src,
                        trigger.label,
                        trigger.duration || 5000
                    );
                }
                setTimeout(() => {
                    paused = false;
                    requestAnimationFrame(typeChar);
                }, 1000);
                return;
            }
        }

        for (const audioTrigger of ambientAudioTriggers) {
            if (!audioTrigger.triggered && typedSoFar.includes(audioTrigger.keyword)) {
                audioTrigger.triggered = true;
                playAmbientLoop(audioTrigger.audioUrl);
            }
        }

        setTimeout(() => requestAnimationFrame(typeChar), delay);
    }

    function startGame() {
        requestAnimationFrame(typeChar);
    }
});
</script>

</body>
</html>

